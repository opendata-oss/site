#!/usr/bin/env node

import { writeFileSync } from 'fs';

const REPO = 'opendata-oss/opendata';
const COMPONENT_FILE = 'src/components/Contributors.astro';

async function main() {
  console.log(`Fetching contributors from ${REPO}...`);

  const response = await fetch(`https://api.github.com/repos/${REPO}/contributors`);
  const contributors = await response.json();

  const avatarHtml = contributors
    .map(
      (c) =>
        `  <a href="https://github.com/${c.login}" target="_blank" rel="noopener"><img src="${c.avatar_url}" alt="${c.login}" class="w-10 h-10 rounded-full border-2 border-white hover:scale-110 transition-transform" /></a>`
    )
    .join('\n');

  const component = `---
// Auto-generated by npm run update-contributors
---

<div class="flex -space-x-3">
${avatarHtml}
  <a href="https://github.com/${REPO}/issues" target="_blank" rel="noopener" class="w-10 h-10 rounded-full border-2 border-white bg-slate-100 hover:bg-slate-200 transition-colors flex items-center justify-center text-slate-500 hover:text-slate-700" title="Become a contributor">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
  </a>
</div>
`;

  writeFileSync(COMPONENT_FILE, component);

  console.log(`Updated ${contributors.length} contributors in ${COMPONENT_FILE}`);
}

main().catch(console.error);
